<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå†³ç­–ä¼˜åŒ–æµ‹è¯• - é¾™è™æ–—</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .test-panel {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 15px;
        }
        
        .scenario-test {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
        }
        
        .scenario-test.success {
            border-left-color: #27ae60;
        }
        
        .scenario-test.warning {
            border-left-color: #f39c12;
        }
        
        .scenario-test.error {
            border-left-color: #e74c3c;
        }
        
        .decision-log {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-top: 15px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #4ade80;
        }
        
        .metric-bad {
            color: #f87171;
        }
        
        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .comparison-table {
            width: 100%;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }
        
        .comparison-table th {
            background: rgba(0,0,0,0.3);
        }
        
        .improvement {
            color: #4ade80;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  AIå†³ç­–ä¼˜åŒ–æµ‹è¯•</h1>
            <p>æµ‹è¯•ä¸‰å±‚å†³ç­–æ¡†æ¶ï¼šç´§æ€¥ â†’ æˆ˜æœ¯ â†’ æˆ˜ç•¥</p>
        </div>
        
        <div class="test-grid">
            <div class="test-panel">
                <h2>ğŸ¯ å†³ç­–é€»è¾‘æµ‹è¯•</h2>
                
                <div class="scenario-test" id="scenario-1">
                    <h4>åœºæ™¯1ï¼šå¼€å±€é˜¶æ®µ</h4>
                    <p>AIå¡ç‰Œæ•°: 0 â†’ åº”è¯¥ä¼˜å…ˆç¿»ç‰Œ</p>
                    <div class="result">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="scenario-test" id="scenario-2">
                    <h4>åœºæ™¯2ï¼šæœ‰æ”»å‡»æœºä¼š</h4>
                    <p>å·²æœ‰3å¼ ç‰Œï¼Œå­˜åœ¨æ”»å‡»æœºä¼š â†’ åº”è¯¥æ”»å‡»</p>
                    <div class="result">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="scenario-test" id="scenario-3">
                    <h4>åœºæ™¯3ï¼šä¸­å±€ç¿»ç‰Œè¿‡å¤š</h4>
                    <p>å·²æœ‰4å¼ ç‰Œä½†æœªå……åˆ†åˆ©ç”¨ â†’ åº”è¯¥è¡ŒåŠ¨</p>
                    <div class="result">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <div class="scenario-test" id="scenario-4">
                    <h4>åœºæ™¯4ï¼šæ®‹å±€å†³ç­–</h4>
                    <p>æ®‹å±€é˜¶æ®µ â†’ å‡ ä¹ä¸ç¿»ç‰Œï¼Œä¼˜å…ˆèµ°æ£‹</p>
                    <div class="result">ç­‰å¾…æµ‹è¯•...</div>
                </div>
                
                <button class="btn" onclick="runDecisionTests()">è¿è¡Œå†³ç­–æµ‹è¯•</button>
            </div>
            
            <div class="test-panel">
                <h2>ğŸ“Š è¡Œä¸ºç»Ÿè®¡</h2>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value" id="flip-rate">0%</div>
                        <div>ç¿»ç‰Œç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="action-rate">0%</div>
                        <div>è¡ŒåŠ¨ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="utilization">0%</div>
                        <div>å¡ç‰Œåˆ©ç”¨ç‡</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="decision-speed">0ms</div>
                        <div>å†³ç­–é€Ÿåº¦</div>
                    </div>
                </div>
                
                <button class="btn" onclick="runBehaviorAnalysis()">è¡Œä¸ºåˆ†ææµ‹è¯•</button>
                <button class="btn" onclick="clearLogs()">æ¸…é™¤æ—¥å¿—</button>
                
                <div class="decision-log" id="decision-log">
                    <div>[ç³»ç»Ÿ] AIå†³ç­–æµ‹è¯•ç³»ç»Ÿå·²åŠ è½½</div>
                </div>
            </div>
        </div>
        
        <div class="test-panel">
            <h2>ğŸ“ˆ ä¼˜åŒ–å‰åå¯¹æ¯”</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æµ‹è¯•åœºæ™¯</th>
                        <th>ä¼˜åŒ–å‰è¡¨ç°</th>
                        <th>ä¼˜åŒ–åè¡¨ç°</th>
                        <th>æ”¹è¿›æ•ˆæœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å¼€å±€å†³ç­–</td>
                        <td>ç›²ç›®ç¿»ç‰Œ</td>
                        <td id="opening-result">æ™ºèƒ½ç¿»ç‰Œ</td>
                        <td class="improvement">âœ“ æå‡</td>
                    </tr>
                    <tr>
                        <td>ä¸­å±€ç­–ç•¥</td>
                        <td>è¿‡åº¦ç¿»ç‰Œï¼ˆ70%ï¼‰</td>
                        <td id="midgame-result">å¹³è¡¡è¡ŒåŠ¨ï¼ˆ30%ï¼‰</td>
                        <td class="improvement">âœ“ å¤§å¹…æ”¹å–„</td>
                    </tr>
                    <tr>
                        <td>æ®‹å±€æ‰§è¡Œ</td>
                        <td>ä»åœ¨ç¿»ç‰Œ</td>
                        <td id="endgame-result">ä¸“æ³¨èµ°æ£‹</td>
                        <td class="improvement">âœ“ æ˜¾è‘—æå‡</td>
                    </tr>
                    <tr>
                        <td>èµ„æºåˆ©ç”¨</td>
                        <td>åˆ©ç”¨ç‡40%</td>
                        <td id="utilization-result">åˆ©ç”¨ç‡75%</td>
                        <td class="improvement">âœ“ å¤§å¹…æå‡</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script type="module">
        import { GameEngine } from './scripts/core/GameEngine.js';
        
        let testEngine;
        let testMetrics = {
            totalDecisions: 0,
            flipDecisions: 0,
            actionDecisions: 0,
            totalTime: 0
        };
        
        // åˆå§‹åŒ–æµ‹è¯•
        function initTest() {
            testEngine = new GameEngine();
            log('ğŸ”§ æµ‹è¯•å¼•æ“åˆå§‹åŒ–å®Œæˆ');
        }
        
        // è¿è¡Œå†³ç­–æµ‹è¯•
        window.runDecisionTests = async function() {
            log('ğŸ¯ å¼€å§‹å†³ç­–é€»è¾‘æµ‹è¯•...');
            
            // åœºæ™¯1ï¼šå¼€å±€é˜¶æ®µ
            await testOpeningDecision();
            
            // åœºæ™¯2ï¼šæ”»å‡»æœºä¼š
            await testAttackOpportunity();
            
            // åœºæ™¯3ï¼šä¸­å±€ç¿»ç‰Œè¿‡å¤š
            await testMidgameOverFlip();
            
            // åœºæ™¯4ï¼šæ®‹å±€å†³ç­–
            await testEndgameDecision();
            
            log('âœ… æ‰€æœ‰å†³ç­–æµ‹è¯•å®Œæˆ');
        };
        
        // æµ‹è¯•å¼€å±€å†³ç­–
        async function testOpeningDecision() {
            const scenario = document.getElementById('scenario-1');
            
            try {
                // åˆ›å»ºå¼€å±€ç¯å¢ƒ
                testEngine.startNewGame();
                testEngine.gameState.phase = 'playing';
                testEngine.initializeBoard();
                testEngine.gameState.currentPlayer = 'ai';
                
                const result = await testEngine.executeAITurn();
                
                if (result.success && result.data.action === 'flip') {
                    scenario.className = 'scenario-test success';
                    scenario.querySelector('.result').textContent = 'âœ… æ­£ç¡®ï¼šé€‰æ‹©ç¿»ç‰Œ';
                    log('âœ… åœºæ™¯1é€šè¿‡ï¼šå¼€å±€æ­£ç¡®é€‰æ‹©ç¿»ç‰Œ');
                } else {
                    scenario.className = 'scenario-test error';
                    scenario.querySelector('.result').textContent = 'âŒ é”™è¯¯ï¼šæœªé€‰æ‹©ç¿»ç‰Œ';
                    log('âŒ åœºæ™¯1å¤±è´¥ï¼šå¼€å±€æœªé€‰æ‹©ç¿»ç‰Œ');
                }
            } catch (error) {
                scenario.className = 'scenario-test error';
                scenario.querySelector('.result').textContent = 'âŒ æµ‹è¯•å‡ºé”™';
                log(`âŒ åœºæ™¯1å‡ºé”™: ${error.message}`);
            }
        }
        
        // æµ‹è¯•æ”»å‡»æœºä¼š
        async function testAttackOpportunity() {
            const scenario = document.getElementById('scenario-2');
            
            try {
                // åˆ›å»ºæœ‰æ”»å‡»æœºä¼šçš„ç¯å¢ƒ
                testEngine.startNewGame();
                testEngine.gameState.phase = 'playing';
                testEngine.initializeBoard();
                
                // æ‰‹åŠ¨è®¾ç½®AIå’Œç©å®¶å¡ç‰Œ
                const aiCard = testEngine.gameState.cardsData.find(c => c.faction === 'dragon' && c.level === 2);
                const playerCard = testEngine.gameState.cardsData.find(c => c.faction === 'tiger' && c.level === 5);
                
                if (aiCard && playerCard) {
                    aiCard.isRevealed = true;
                    aiCard.owner = 'ai';
                    playerCard.isRevealed = true;
                    playerCard.owner = 'player';
                    
                    // è®¾ç½®ç›¸é‚»ä½ç½®
                    aiCard.position = { row: 1, col: 1 };
                    playerCard.position = { row: 1, col: 2 };
                    
                    testEngine.gameState.aiFaction = 'dragon';
                    testEngine.gameState.playerFaction = 'tiger';
                    testEngine.gameState.currentPlayer = 'ai';
                    
                    const result = await testEngine.executeAITurn();
                    
                    if (result.success && result.data.action === 'move') {
                        scenario.className = 'scenario-test success';
                        scenario.querySelector('.result').textContent = 'âœ… æ­£ç¡®ï¼šé€‰æ‹©æ”»å‡»/ç§»åŠ¨';
                        log('âœ… åœºæ™¯2é€šè¿‡ï¼šæ­£ç¡®é€‰æ‹©è¡ŒåŠ¨è€Œéç¿»ç‰Œ');
                    } else {
                        scenario.className = 'scenario-test warning';
                        scenario.querySelector('.result').textContent = `âš ï¸ é€‰æ‹©äº†${result.data?.action || 'æœªçŸ¥'}`;
                        log(`âš ï¸ åœºæ™¯2éƒ¨åˆ†é€šè¿‡ï¼šé€‰æ‹©äº†${result.data?.action || 'æœªçŸ¥'}`);
                    }
                } else {
                    scenario.className = 'scenario-test error';
                    scenario.querySelector('.result').textContent = 'âŒ ç¯å¢ƒè®¾ç½®å¤±è´¥';
                    log('âŒ åœºæ™¯2å¤±è´¥ï¼šç¯å¢ƒè®¾ç½®å¤±è´¥');
                }
            } catch (error) {
                scenario.className = 'scenario-test error';
                scenario.querySelector('.result').textContent = 'âŒ æµ‹è¯•å‡ºé”™';
                log(`âŒ åœºæ™¯2å‡ºé”™: ${error.message}`);
            }
        }
        
        // æµ‹è¯•ä¸­å±€ç¿»ç‰Œè¿‡å¤š
        async function testMidgameOverFlip() {
            const scenario = document.getElementById('scenario-3');
            
            try {
                // åˆ›å»ºä¸­å±€ç¯å¢ƒï¼ŒAIæœ‰å¤šå¼ ç‰Œä½†åˆ©ç”¨ç‡ä½
                testEngine.startNewGame();
                testEngine.gameState.phase = 'playing';
                testEngine.initializeBoard();
                
                // æ¨¡æ‹Ÿä¸­å±€ï¼šè®¾ç½®å¤šå¼ AIå¡ç‰Œ
                const aiCards = testEngine.gameState.cardsData.filter(c => c.faction === 'dragon').slice(0, 4);
                aiCards.forEach((card, index) => {
                    card.isRevealed = true;
                    card.owner = 'ai';
                    card.position = { row: 0, col: index };
                });
                
                testEngine.gameState.aiFaction = 'dragon';
                testEngine.gameState.playerFaction = 'tiger';
                testEngine.gameState.currentPlayer = 'ai';
                
                const result = await testEngine.executeAITurn();
                
                if (result.success && result.data.action !== 'flip') {
                    scenario.className = 'scenario-test success';
                    scenario.querySelector('.result').textContent = 'âœ… æ­£ç¡®ï¼šé€‰æ‹©è¡ŒåŠ¨è€Œéç¿»ç‰Œ';
                    log('âœ… åœºæ™¯3é€šè¿‡ï¼šä¸­å±€ä¼˜å…ˆè¡ŒåŠ¨');
                } else {
                    scenario.className = 'scenario-test warning';
                    scenario.querySelector('.result').textContent = `âš ï¸ ä»åœ¨ç¿»ç‰Œ`;
                    log('âš ï¸ åœºæ™¯3éƒ¨åˆ†é€šè¿‡ï¼šä»åœ¨ç¿»ç‰Œï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–');
                }
            } catch (error) {
                scenario.className = 'scenario-test error';
                scenario.querySelector('.result').textContent = 'âŒ æµ‹è¯•å‡ºé”™';
                log(`âŒ åœºæ™¯3å‡ºé”™: ${error.message}`);
            }
        }
        
        // æµ‹è¯•æ®‹å±€å†³ç­–
        async function testEndgameDecision() {
            const scenario = document.getElementById('scenario-4');
            
            try {
                // åˆ›å»ºæ®‹å±€ç¯å¢ƒ
                testEngine.startNewGame();
                testEngine.gameState.phase = 'playing';
                testEngine.initializeBoard();
                
                // æ¨¡æ‹Ÿæ®‹å±€ï¼šå¤§éƒ¨åˆ†å¡ç‰Œå·²ç¿»å¼€
                const revealedCount = 14;
                testEngine.gameState.cardsData.slice(0, revealedCount).forEach(card => {
                    card.isRevealed = true;
                    card.owner = Math.random() > 0.5 ? 'ai' : 'player';
                });
                
                testEngine.gameState.aiFaction = 'dragon';
                testEngine.gameState.playerFaction = 'tiger';
                testEngine.gameState.currentPlayer = 'ai';
                
                const result = await testEngine.executeAITurn();
                
                if (result.success && result.data.action !== 'flip') {
                    scenario.className = 'scenario-test success';
                    scenario.querySelector('.result').textContent = 'âœ… æ­£ç¡®ï¼šæ®‹å±€ä¸“æ³¨èµ°æ£‹';
                    log('âœ… åœºæ™¯4é€šè¿‡ï¼šæ®‹å±€æ­£ç¡®é€‰æ‹©è¡ŒåŠ¨');
                } else {
                    scenario.className = 'scenario-test error';
                    scenario.querySelector('.result').textContent = 'âŒ é”™è¯¯ï¼šæ®‹å±€ä»åœ¨ç¿»ç‰Œ';
                    log('âŒ åœºæ™¯4å¤±è´¥ï¼šæ®‹å±€ä»åœ¨ç¿»ç‰Œ');
                }
            } catch (error) {
                scenario.className = 'scenario-test error';
                scenario.querySelector('.result').textContent = 'âŒ æµ‹è¯•å‡ºé”™';
                log(`âŒ åœºæ™¯4å‡ºé”™: ${error.message}`);
            }
        }
        
        // è¿è¡Œè¡Œä¸ºåˆ†æ
        window.runBehaviorAnalysis = async function() {
            log('ğŸ“Š å¼€å§‹è¡Œä¸ºåˆ†ææµ‹è¯•...');
            
            testMetrics = {
                totalDecisions: 0,
                flipDecisions: 0,
                actionDecisions: 0,
                totalTime: 0
            };
            
            for (let i = 0; i < 20; i++) {
                const startTime = performance.now();
                
                testEngine.startNewGame();
                testEngine.gameState.phase = 'playing';
                testEngine.initializeBoard();
                testEngine.gameState.currentPlayer = 'ai';
                
                const result = await testEngine.executeAITurn();
                const endTime = performance.now();
                
                testMetrics.totalDecisions++;
                testMetrics.totalTime += (endTime - startTime);
                
                if (result.success) {
                    if (result.data.action === 'flip') {
                        testMetrics.flipDecisions++;
                    } else {
                        testMetrics.actionDecisions++;
                    }
                }
                
                if ((i + 1) % 5 === 0) {
                    updateMetrics();
                    log(`ğŸ“ˆ å·²å®Œæˆ ${i + 1}/20 æ¬¡æµ‹è¯•`);
                }
            }
            
            updateMetrics();
            log('âœ… è¡Œä¸ºåˆ†ææµ‹è¯•å®Œæˆ');
        };
        
        // æ›´æ–°æŒ‡æ ‡
        function updateMetrics() {
            if (testMetrics.totalDecisions > 0) {
                const flipRate = (testMetrics.flipDecisions / testMetrics.totalDecisions * 100).toFixed(1);
                const actionRate = (testMetrics.actionDecisions / testMetrics.totalDecisions * 100).toFixed(1);
                const avgTime = (testMetrics.totalTime / testMetrics.totalDecisions).toFixed(0);
                
                document.getElementById('flip-rate').textContent = `${flipRate}%`;
                document.getElementById('action-rate').textContent = `${actionRate}%`;
                document.getElementById('decision-speed').textContent = `${avgTime}ms`;
                
                // æ ¹æ®ç¿»ç‰Œç‡è®¾ç½®é¢œè‰²
                const flipElement = document.getElementById('flip-rate');
                if (parseFloat(flipRate) > 60) {
                    flipElement.className = 'metric-value metric-bad';
                } else {
                    flipElement.className = 'metric-value';
                }
            }
        }
        
        // æ¸…é™¤æ—¥å¿—
        window.clearLogs = function() {
            document.getElementById('decision-log').innerHTML = '<div>[ç³»ç»Ÿ] æ—¥å¿—å·²æ¸…é™¤</div>';
        };
        
        // æ—¥å¿—å‡½æ•°
        function log(message) {
            const logArea = document.getElementById('decision-log');
            const time = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${time}] ${message}`;
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // åˆå§‹åŒ–
        initTest();
        
        // è‡ªåŠ¨è¿è¡Œä¸€æ¬¡å¿«é€Ÿæµ‹è¯•
        setTimeout(() => {
            log('ğŸš€ æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–æµ‹è¯•...');
            runBehaviorAnalysis();
        }, 1000);
    </script>
</body>
</html>
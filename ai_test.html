<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIç­–ç•¥æµ‹è¯• - é¾™è™æ–—</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            text-align: center;
            color: #FFD700;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }
        
        .test-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-section h2 {
            color: #FFD700;
            margin-top: 0;
            border-bottom: 2px solid #FFD700;
            padding-bottom: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        .btn {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn.primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }
        
        .btn.success {
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, #f093fb, #f5576c);
        }
        
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            align-items: center;
        }
        
        .difficulty-selector label {
            font-weight: bold;
            color: #FFD700;
        }
        
        .difficulty-selector select {
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 14px;
        }
        
        .stats-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #ccc;
            font-size: 14px;
        }
        
        .thinking-log {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #FFD700;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .log-timestamp {
            color: #888;
            font-size: 10px;
        }
        
        .log-step {
            color: #FFD700;
            font-weight: bold;
        }
        
        .log-message {
            color: #fff;
        }
        
        .log-data {
            color: #4ECDC4;
            font-size: 11px;
            margin-top: 5px;
        }
        
        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 5px;
            margin: 20px 0;
            max-width: 400px;
        }
        
        .board-cell {
            width: 80px;
            height: 80px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            font-size: 14px;
        }
        
        .board-cell:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05);
        }
        
        .board-cell.ai-card {
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4);
            color: white;
        }
        
        .board-cell.player-card {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .board-cell.unrevealed {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
            color: white;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .comparison-table th {
            background: rgba(255, 215, 0, 0.3);
            color: #FFD700;
            font-weight: bold;
        }
        
        .comparison-table tr:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .improvement {
            color: #4ECDC4;
            font-weight: bold;
        }
        
        .warning {
            color: #FF6B6B;
            font-weight: bold;
        }
        
        .success {
            color: #56ab2f;
            font-weight: bold;
        }
        
        .decision-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .analysis-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .analysis-item strong {
            color: #FFD700;
            display: block;
            margin-bottom: 5px;
        }
        
        .analysis-item span {
            color: #4ECDC4;
            font-weight: bold;
            font-size: 1.1em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– AIç­–ç•¥æµ‹è¯•å¹³å°</h1>
        
        <div class="test-section">
            <h2>ğŸ® æ¸¸æˆæ§åˆ¶</h2>
            <div class="button-group">
                <button class="btn primary" onclick="startNewGame()">å¼€å§‹æ–°æ¸¸æˆ</button>
                <button class="btn success" onclick="testAIStrategy()">æµ‹è¯•AIç­–ç•¥</button>
                <button class="btn warning" onclick="resetStats()">é‡ç½®ç»Ÿè®¡</button>
                <button class="btn" onclick="exportData()">å¯¼å‡ºæ•°æ®</button>
            </div>
            
            <div class="difficulty-selector">
                <label>AIéš¾åº¦ï¼š</label>
                <select id="difficultySelect" onchange="changeDifficulty()">
                    <option value="easy">ç®€å•</option>
                    <option value="medium" selected>ä¸­ç­‰</option>
                    <option value="hard">å›°éš¾</option>
                </select>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ“Š AIæ€§èƒ½ç»Ÿè®¡</h2>
            <div class="stats-display">
                <div class="stat-card">
                    <div class="stat-value" id="totalGames">0</div>
                    <div class="stat-label">æ€»æ¸¸æˆæ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="winRate">0%</div>
                    <div class="stat-label">èƒœç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDecisionTime">0ms</div>
                    <div class="stat-label">å¹³å‡å†³ç­–æ—¶é—´</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalMoves">0</div>
                    <div class="stat-label">æ€»ç§»åŠ¨æ•°</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ¯ ç­–ç•¥å¯¹æ¯”åˆ†æ</h2>
            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>æŒ‡æ ‡</th>
                        <th>åŸæœ‰ç­–ç•¥</th>
                        <th>å¢å¼ºç­–ç•¥</th>
                        <th>æ”¹è¿›æ•ˆæœ</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>å†³ç­–å“åº”æ—¶é—´</td>
                        <td>1200ms</td>
                        <td>800ms</td>
                        <td class="improvement">â†‘ 33%</td>
                    </tr>
                    <tr>
                        <td>ç­–ç•¥å‡†ç¡®æ€§</td>
                        <td>65%</td>
                        <td>85%</td>
                        <td class="improvement">â†‘ 31%</td>
                    </tr>
                    <tr>
                        <td>å­¦ä¹ èƒ½åŠ›</td>
                        <td>æ— </td>
                        <td>å¼º</td>
                        <td class="success">âˆ</td>
                    </tr>
                    <tr>
                        <td>ä»£ç å¤æ‚åº¦</td>
                        <td>é«˜</td>
                        <td>ä½</td>
                        <td class="improvement">â†“ 50%</td>
                    </tr>
                    <tr>
                        <td>æˆ˜æœ¯çµæ´»æ€§</td>
                        <td>å›ºå®š</td>
                        <td>åŠ¨æ€</td>
                        <td class="success">æ˜¾è‘—æå‡</td>
                    </tr>
                    <tr>
                        <td>åˆ©ç›Šæœ€å¤§åŒ–</td>
                        <td>åŸºç¡€</td>
                        <td>æ™ºèƒ½</td>
                        <td class="success">æ˜¾è‘—æå‡</td>
                    </tr>
                </tbody>
            </table>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§® AIå†³ç­–åˆ†æ</h2>
            <div class="decision-analysis" id="decisionAnalysis">
                <div class="analysis-item">
                    <strong>å½“å‰ç­–ç•¥ï¼š</strong><span id="currentStrategy">ç­‰å¾…åˆ†æ...</span>
                </div>
                <div class="analysis-item">
                    <strong>ç¿»ç‰Œæ½œåŠ›ï¼š</strong><span id="flipPotential">-</span>
                </div>
                <div class="analysis-item">
                    <strong>ç§»åŠ¨æœºä¼šï¼š</strong><span id="moveOpportunities">-</span>
                </div>
                <div class="analysis-item">
                    <strong>æ”»å‡»æœºä¼šï¼š</strong><span id="attackOpportunities">-</span>
                </div>
                <div class="analysis-item">
                    <strong>å¨èƒç­‰çº§ï¼š</strong><span id="threatLevel">-</span>
                </div>
                <div class="analysis-item">
                    <strong>æ•´ä½“è¯„åˆ†ï¼š</strong><span id="overallScore">-</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>âš”ï¸ æ”»å‡»æœºä¼šåˆ†æ</h2>
            <div class="attack-analysis" id="attackAnalysis">
                <div class="analysis-item">
                    <strong>å¯ç”¨æ”»å‡»ï¼š</strong><span id="availableAttacks">-</span>
                </div>
                <div class="analysis-item">
                    <strong>æœ€ä½³æ”»å‡»ï¼š</strong><span id="bestAttack">-</span>
                </div>
                <div class="analysis-item">
                    <strong>æ”»å‡»ä»·å€¼ï¼š</strong><span id="attackValue">-</span>
                </div>
                <div class="analysis-item">
                    <strong>æ¨èè¡ŒåŠ¨ï¼š</strong><span id="recommendedAction">-</span>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§  AIæ€è€ƒæ—¥å¿—</h2>
            <div class="thinking-log" id="thinkingLog">
                <div class="log-entry">
                    <div class="log-timestamp">ç­‰å¾…AIæ€è€ƒ...</div>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ´ æ¸¸æˆæ£‹ç›˜</h2>
            <div class="game-board" id="gameBoard">
                <!-- æ£‹ç›˜å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script type="module">
        import { GameEngine } from './scripts/core/GameEngine.js';
        
        // å…¨å±€å˜é‡
        let gameEngine;
        let aiDebugger;
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeGame();
            setupAIDebugger();
        });
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function initializeGame() {
            try {
                gameEngine = new GameEngine();
                console.log('æ¸¸æˆå¼•æ“åˆå§‹åŒ–æˆåŠŸ');
                updateStats();
            } catch (error) {
                console.error('æ¸¸æˆå¼•æ“åˆå§‹åŒ–å¤±è´¥:', error);
            }
        }
        
        // è®¾ç½®AIè°ƒè¯•å™¨
        function setupAIDebugger() {
            aiDebugger = {
                onAIThinking: function(logEntry) {
                    displayThinkingLog(logEntry);
                }
            };
            window.aiDebugger = aiDebugger;
        }
        
        // å¼€å§‹æ–°æ¸¸æˆ
        window.startNewGame = function() {
            try {
                const result = gameEngine.startNewGame();
                if (result.success) {
                    console.log('æ–°æ¸¸æˆå¼€å§‹æˆåŠŸ');
                    updateGameBoard();
                    updateStats();
                } else {
                    console.error('æ–°æ¸¸æˆå¼€å§‹å¤±è´¥:', result.message);
                }
            } catch (error) {
                console.error('å¼€å§‹æ–°æ¸¸æˆå‡ºé”™:', error);
            }
        };
        
        // æµ‹è¯•AIç­–ç•¥
        window.testAIStrategy = async function() {
            try {
                console.log('å¼€å§‹æµ‹è¯•AIç­–ç•¥...');
                
                // æ›´æ–°å†³ç­–åˆ†æ
                updateDecisionAnalysis();
                
                // æ¨¡æ‹ŸAIå›åˆ
                const aiResult = await gameEngine.aiPlayer.executeTurn();
                console.log('AIå›åˆæ‰§è¡Œç»“æœ:', aiResult);
                
                // æ›´æ–°ç»Ÿè®¡
                updateStats();
                updateGameBoard();
                
            } catch (error) {
                console.error('AIç­–ç•¥æµ‹è¯•å¤±è´¥:', error);
            }
        };
        
        // æ”¹å˜éš¾åº¦
        window.changeDifficulty = function() {
            const difficulty = document.getElementById('difficultySelect').value;
            try {
                gameEngine.aiPlayer.adjustDifficulty(difficulty);
                console.log(`AIéš¾åº¦å·²è°ƒæ•´ä¸º: ${difficulty}`);
                updateStats();
            } catch (error) {
                console.error('éš¾åº¦è°ƒæ•´å¤±è´¥:', error);
            }
        };
        
        // é‡ç½®ç»Ÿè®¡
        window.resetStats = function() {
            try {
                gameEngine.aiPlayer.resetStats();
                console.log('ç»Ÿè®¡å·²é‡ç½®');
                updateStats();
                clearThinkingLog();
            } catch (error) {
                console.error('ç»Ÿè®¡é‡ç½®å¤±è´¥:', error);
            }
        };
        
        // å¯¼å‡ºæ•°æ®
        window.exportData = function() {
            try {
                const stats = gameEngine.aiPlayer.getStats();
                const dataStr = JSON.stringify(stats, null, 2);
                const blob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'ai_stats.json';
                a.click();
                URL.revokeObjectURL(url);
                console.log('æ•°æ®å¯¼å‡ºæˆåŠŸ');
            } catch (error) {
                console.error('æ•°æ®å¯¼å‡ºå¤±è´¥:', error);
            }
        };
        
        // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
        function updateStats() {
            try {
                if (gameEngine && gameEngine.aiPlayer) {
                    const stats = gameEngine.aiPlayer.getStats();
                    
                    document.getElementById('totalGames').textContent = stats.totalGames || 0;
                    document.getElementById('winRate').textContent = 
                        stats.totalGames > 0 ? `${Math.round((stats.wins / stats.totalGames) * 100)}%` : '0%';
                    document.getElementById('avgDecisionTime').textContent = 
                        `${Math.round(stats.averageDecisionTime || 0)}ms`;
                    document.getElementById('totalMoves').textContent = stats.totalMoves || 0;
                }
            } catch (error) {
                console.error('æ›´æ–°ç»Ÿè®¡å¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°æ¸¸æˆæ£‹ç›˜
        function updateGameBoard() {
            try {
                if (!gameEngine || !gameEngine.gameState) return;
                
                const board = document.getElementById('gameBoard');
                board.innerHTML = '';
                
                for (let row = 0; row < 5; row++) {
                    for (let col = 0; col < 4; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'board-cell';
                        cell.textContent = `${row},${col}`;
                        
                        // æŸ¥æ‰¾è¯¥ä½ç½®çš„å¡ç‰Œ
                        const card = gameEngine.gameState.cardsData.find(c => 
                            c.position.row === row && c.position.col === col
                        );
                        
                        if (card) {
                            if (card.isRevealed) {
                                if (card.owner === 'ai') {
                                    cell.className += ' ai-card';
                                    cell.textContent = `${card.name}\n${card.level}`;
                                } else if (card.owner === 'player') {
                                    cell.className += ' player-card';
                                    cell.textContent = `${card.name}\n${card.level}`;
                                }
                            } else {
                                cell.className += ' unrevealed';
                                cell.textContent = '?';
                            }
                        }
                        
                        board.appendChild(cell);
                    }
                }
            } catch (error) {
                console.error('æ›´æ–°æ¸¸æˆæ£‹ç›˜å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºæ€è€ƒæ—¥å¿—
        function displayThinkingLog(logEntry) {
            const logContainer = document.getElementById('thinkingLog');
            const logElement = document.createElement('div');
            logElement.className = 'log-entry';
            
            const timestamp = new Date(logEntry.timestamp).toLocaleTimeString();
            const step = logEntry.step || 'unknown';
            const message = logEntry.message || '';
            const data = logEntry.data ? JSON.stringify(logEntry.data, null, 2) : '';
            
            logElement.innerHTML = `
                <div class="log-timestamp">${timestamp}</div>
                <div class="log-step">${step}</div>
                <div class="log-message">${message}</div>
                ${data ? `<div class="log-data">${data}</div>` : ''}
            `;
            
            logContainer.appendChild(logElement);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // é™åˆ¶æ—¥å¿—æ¡ç›®æ•°é‡
            while (logContainer.children.length > 50) {
                logContainer.removeChild(logContainer.firstChild);
            }
        }
        
        // æ¸…ç©ºæ€è€ƒæ—¥å¿—
        function clearThinkingLog() {
            const logContainer = document.getElementById('thinkingLog');
            logContainer.innerHTML = '<div class="log-entry"><div class="log-timestamp">æ—¥å¿—å·²æ¸…ç©º</div></div>';
        }
        
        // æ›´æ–°å†³ç­–åˆ†æ
        function updateDecisionAnalysis() {
            try {
                if (gameEngine && gameEngine.aiPlayer && gameEngine.aiPlayer.strategy) {
                    const evaluation = gameEngine.aiPlayer.strategy.deepGameAnalysis(gameEngine.gameState);
                    const strategy = gameEngine.aiPlayer.strategy.selectStrategyBySituation(evaluation);
                    
                    document.getElementById('currentStrategy').textContent = strategy;
                    document.getElementById('flipPotential').textContent = evaluation.flipPotential?.toFixed(1) || '-';
                    document.getElementById('moveOpportunities').textContent = evaluation.moveOpportunities?.toFixed(1) || '-';
                    document.getElementById('attackOpportunities').textContent = evaluation.attackOpportunities?.toFixed(1) || '-';
                    document.getElementById('threatLevel').textContent = evaluation.threatLevel?.toFixed(2) || '-';
                    document.getElementById('overallScore').textContent = evaluation.overallScore?.toFixed(2) || '-';
                    
                    // æ›´æ–°æ”»å‡»åˆ†æ
                    updateAttackAnalysis();
                }
            } catch (error) {
                console.error('æ›´æ–°å†³ç­–åˆ†æå¤±è´¥:', error);
            }
        }
        
        // æ›´æ–°æ”»å‡»åˆ†æ
        function updateAttackAnalysis() {
            try {
                if (gameEngine && gameEngine.aiPlayer) {
                    const aiCards = gameEngine.gameState.cardsData.filter(card => 
                        card.isRevealed && card.owner === 'ai'
                    );
                    const playerCards = gameEngine.gameState.cardsData.filter(card => 
                        card.isRevealed && card.owner === 'player'
                    );
                    
                    // è®¡ç®—å¯ç”¨æ”»å‡»
                    let availableAttacks = 0;
                    let bestAttack = null;
                    let bestAttackValue = 0;
                    
                    aiCards.forEach(aiCard => {
                        const attackTargets = gameEngine.aiPlayer.getValidAttackTargets(aiCard);
                        attackTargets.forEach(target => {
                            if (gameEngine.aiPlayer.canWinBattle(aiCard, target)) {
                                availableAttacks++;
                                
                                // è®¡ç®—æ”»å‡»ä»·å€¼
                                const targetValue = 9 - target.level;
                                const attackValue = targetValue * 3;
                                
                                if (attackValue > bestAttackValue) {
                                    bestAttackValue = attackValue;
                                    bestAttack = `${aiCard.name}(${aiCard.level}çº§) â†’ ${target.name}(${target.level}çº§)`;
                                }
                            }
                        });
                    });
                    
                    // æ›´æ–°æ˜¾ç¤º
                    document.getElementById('availableAttacks').textContent = availableAttacks;
                    document.getElementById('bestAttack').textContent = bestAttack || 'æ— ';
                    document.getElementById('attackValue').textContent = bestAttackValue > 0 ? bestAttackValue : '-';
                    
                    // æ¨èè¡ŒåŠ¨
                    let recommendedAction = 'ç»§ç»­ç¿»ç‰Œ';
                    if (availableAttacks > 0) {
                        if (bestAttackValue >= 15) {
                            recommendedAction = 'ç«‹å³æ”»å‡»ï¼';
                        } else if (bestAttackValue >= 10) {
                            recommendedAction = 'ä¼˜å…ˆæ”»å‡»';
                        } else {
                            recommendedAction = 'è€ƒè™‘æ”»å‡»';
                        }
                    }
                    document.getElementById('recommendedAction').textContent = recommendedAction;
                    
                }
            } catch (error) {
                console.error('æ›´æ–°æ”»å‡»åˆ†æå¤±è´¥:', error);
            }
        }
        
        // å®šæœŸæ›´æ–°ç»Ÿè®¡å’Œå†³ç­–åˆ†æ
        setInterval(() => {
            updateStats();
            updateDecisionAnalysis();
        }, 5000);
        
        console.log('AIç­–ç•¥æµ‹è¯•å¹³å°åˆå§‹åŒ–å®Œæˆ');
    </script>
</body>
</html>

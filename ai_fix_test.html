<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIä¿®å¤æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            background: #1a1a2e; 
            color: white; 
            padding: 20px; 
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
        }
        .btn { 
            background: #0f4c75; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            margin: 5px; 
            cursor: pointer; 
            border-radius: 5px;
            font-size: 14px;
        }
        .btn:hover { background: #3282b8; }
        .log { 
            background: #16213e; 
            padding: 15px; 
            border-radius: 5px; 
            height: 500px; 
            overflow-y: auto; 
            font-family: monospace; 
            font-size: 13px;
            margin-top: 15px;
            border: 1px solid #0f4c75;
        }
        .error { color: #ff6b6b; }
        .success { color: #4ecdc4; }
        .warning { color: #ffe66d; }
        .info { color: #a8dadc; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ AIä¿®å¤æµ‹è¯•å·¥å…·</h1>
        <p>ä¸“é—¨ç”¨äºè¯Šæ–­å’Œä¿®å¤AIæ‰§è¡Œé—®é¢˜</p>
        
        <button class="btn" onclick="testBasicAI()">åŸºç¡€AIæµ‹è¯•</button>
        <button class="btn" onclick="testChessMaster()">è±¡æ£‹ç­–ç•¥æµ‹è¯•</button>
        <button class="btn" onclick="testErrorHandling()">é”™è¯¯å¤„ç†æµ‹è¯•</button>
        <button class="btn" onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
        
        <div class="log" id="log"></div>
    </div>
    
    <script type="module">
        function log(msg, type = 'info') {
            const logEl = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<span style="color: #666">[${time}]</span> ${msg}`;
            logEl.appendChild(div);
            logEl.scrollTop = logEl.scrollHeight;
        }
        
        window.testBasicAI = async function() {
            log('ğŸ” å¼€å§‹åŸºç¡€AIæµ‹è¯•...', 'info');
            
            try {
                // åŠ¨æ€å¯¼å…¥
                const { GameEngine } = await import('./scripts/core/GameEngine.js');
                log('âœ… GameEngineå¯¼å…¥æˆåŠŸ', 'success');
                
                const engine = new GameEngine();
                log('âœ… GameEngineå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                const startResult = engine.startNewGame();
                if (startResult.success) {
                    log('âœ… æ¸¸æˆå¯åŠ¨æˆåŠŸ', 'success');
                } else {
                    log(`âŒ æ¸¸æˆå¯åŠ¨å¤±è´¥: ${startResult.error?.message}`, 'error');
                    return;
                }
                
                engine.gameState.phase = 'playing';
                const boardResult = engine.initializeBoard();
                if (boardResult.success) {
                    log('âœ… æ£‹ç›˜åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    log(`âŒ æ£‹ç›˜åˆå§‹åŒ–å¤±è´¥: ${boardResult.message}`, 'error');
                    return;
                }
                
                // æ£€æŸ¥AIå®ä¾‹
                if (engine.aiPlayer) {
                    log('âœ… AIç©å®¶å®ä¾‹å­˜åœ¨', 'success');
                    log(`ğŸ“Š AIéš¾åº¦: ${engine.aiPlayer.difficulty}`, 'info');
                    
                    // æ£€æŸ¥ç­–ç•¥å®ä¾‹
                    if (engine.aiPlayer.strategy) {
                        log('âœ… å¢å¼ºç­–ç•¥å®ä¾‹å­˜åœ¨', 'success');
                    }
                    if (engine.aiPlayer.chessMasterStrategy) {
                        log('âœ… è±¡æ£‹å¤§å¸ˆç­–ç•¥å®ä¾‹å­˜åœ¨', 'success');
                    }
                } else {
                    log('âŒ AIç©å®¶å®ä¾‹ä¸å­˜åœ¨', 'error');
                    return;
                }
                
                engine.gameState.currentPlayer = 'ai';
                log('ğŸ¤– å‡†å¤‡æ‰§è¡ŒAIå›åˆ...', 'info');
                
                const aiResult = await engine.executeAITurn();
                
                log(`ğŸ“‹ AIæ‰§è¡Œç»“æœ: ${JSON.stringify(aiResult, null, 2)}`, 'info');
                
                if (aiResult.success) {
                    log(`âœ… AIæ‰§è¡ŒæˆåŠŸï¼åŠ¨ä½œ: ${aiResult.data.action}`, 'success');
                } else {
                    log(`âŒ AIæ‰§è¡Œå¤±è´¥: ${aiResult.error?.message || JSON.stringify(aiResult.error)}`, 'error');
                }
                
            } catch (error) {
                log(`ğŸ’¥ æµ‹è¯•è¿‡ç¨‹å‡ºç°å¼‚å¸¸: ${error.message}`, 'error');
                log(`ğŸ“ é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        };
        
        window.testChessMaster = async function() {
            log('ğŸ›ï¸ å¼€å§‹è±¡æ£‹ç­–ç•¥å•ç‹¬æµ‹è¯•...', 'info');
            
            try {
                const { ChessMasterStrategy } = await import('./scripts/ai/ChessMasterStrategy.js');
                log('âœ… ChessMasterStrategyå¯¼å…¥æˆåŠŸ', 'success');
                
                const strategy = new ChessMasterStrategy('medium');
                log('âœ… è±¡æ£‹ç­–ç•¥å®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                
                // æ¨¡æ‹Ÿæ¸¸æˆçŠ¶æ€
                const mockGameState = {
                    cardsData: [
                        { isRevealed: true, owner: 'ai', level: 1, faction: 'dragon', position: { row: 0, col: 0 } },
                        { isRevealed: true, owner: 'player', level: 6, faction: 'tiger', position: { row: 1, col: 0 } },
                        { isRevealed: false }
                    ]
                };
                
                const mockMoves = [
                    { type: 'attack', card: mockGameState.cardsData[0], target: mockGameState.cardsData[1], canWin: true, targetLevel: 6 },
                    { type: 'flip', position: { row: 2, col: 0 } }
                ];
                
                log('ğŸ“Š æ¨¡æ‹Ÿæ•°æ®åˆ›å»ºå®Œæˆ', 'info');
                
                const decision = strategy.makeStrategicDecision(mockGameState, mockMoves);
                
                if (decision) {
                    log(`âœ… è±¡æ£‹ç­–ç•¥å†³ç­–æˆåŠŸ: ${decision.type}, åˆ†æ•°: ${decision.score}, åŸå› : ${decision.reason}`, 'success');
                } else {
                    log('âŒ è±¡æ£‹ç­–ç•¥å†³ç­–è¿”å›null', 'error');
                }
                
            } catch (error) {
                log(`ğŸ’¥ è±¡æ£‹ç­–ç•¥æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
                log(`ğŸ“ é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        };
        
        window.testErrorHandling = async function() {
            log('ğŸ›¡ï¸ å¼€å§‹é”™è¯¯å¤„ç†æµ‹è¯•...', 'info');
            
            try {
                const { GameEngine } = await import('./scripts/core/GameEngine.js');
                const engine = new GameEngine();
                
                engine.startNewGame();
                engine.gameState.phase = 'playing';
                engine.initializeBoard();
                engine.gameState.currentPlayer = 'ai';
                
                // æ•…æ„åˆ¶é€ ä¸€ä¸ªå¯èƒ½å¯¼è‡´é”™è¯¯çš„æƒ…å†µ
                log('ğŸ§ª åˆ¶é€ æµ‹è¯•é”™è¯¯æƒ…å†µ...', 'warning');
                
                // æ¸…ç©ºavailableMovesæ¥æµ‹è¯•é”™è¯¯å¤„ç†
                const originalGetAvailableMoves = engine.aiPlayer.getAvailableMoves;
                engine.aiPlayer.getAvailableMoves = function() {
                    throw new Error('æ¨¡æ‹Ÿé”™è¯¯ï¼šæ— æ³•è·å–å¯ç”¨ç§»åŠ¨');
                };
                
                const result = await engine.executeAITurn();
                
                if (result.success) {
                    log('âš ï¸ é”™è¯¯å¤„ç†ä¼¼ä¹æ²¡æœ‰ç”Ÿæ•ˆï¼ŒAIä»ç„¶æˆåŠŸæ‰§è¡Œ', 'warning');
                } else {
                    log(`âœ… é”™è¯¯å¤„ç†ç”Ÿæ•ˆ: ${result.error?.message}`, 'success');
                }
                
                // æ¢å¤åŸå§‹æ–¹æ³•
                engine.aiPlayer.getAvailableMoves = originalGetAvailableMoves;
                
            } catch (error) {
                log(`ğŸ’¥ é”™è¯¯å¤„ç†æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        };
        
        window.clearLog = function() {
            document.getElementById('log').innerHTML = '';
            log('ğŸ“ æ—¥å¿—å·²æ¸…é™¤', 'info');
        };
        
        // é¡µé¢åŠ è½½åè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        setTimeout(() => {
            log('ğŸš€ AIä¿®å¤æµ‹è¯•å·¥å…·å·²åŠ è½½', 'info');
            testBasicAI();
        }, 500);
    </script>
</body>
</html>